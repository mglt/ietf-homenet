---
title: DHCPv6 Options for Homenet Authoritative Service
abbrev: DHCPv6 Options for Homenet Naming Authoritative Service
docname: draft-ietf-homenet-naming-architecture-dhc-options-07

area: Internet
wg: Homenet
kw: Internet-Draft
cat: std

coding: us-ascii
pi:
  rfcedstyle: yes
  toc: yes
  tocindent: yes
  sortrefs: yes
  symrefs: yes
  strict: yes
  comments: yes
  inline: yes
  docmapping: yes

author:
      -
        ins: D. Migault
        name: Daniel Migault
        org: Ericsson
        street: 8275 Trans Canada Route
        city: Saint Laurent, QC
        code: 4S 0B6
        country: Canada
        email: daniel.migault@ericsson.com
      -
        ins: R. Weber
        name: Ralf Weber
        org: Nominum
        street: 2000 Seaport Blvd #400
        city: Redwood City
        code: 94063
        country: US
        email: ralf.weber@nominum.com
      -
        ins: T. Mrugalski
        name: Tomek Mrugalski
        org: Internet Systems Consortium, Inc.
        street: 950 Charter Street
        city: Redwood City
        code: 94063
        country: US
        email: tomasz.mrugalski@gmail.com
      -
        ins: C. Griffiths
        name: Chris Griffiths
        org:
        street:
        city:
        code:
        country:
        email: cgriffiths@gmail.com
      -
        ins: W. Cloetens
        name: Wouter Cloetens
        org: SoftAtHome<
        street: vaartdijk 3 701
        city: Wijgmaal
        code: 3018
        country: BE
        email: cgriffiths@gmail.com


--- abstract

<!--
Home network  devices are
usually constrained devices with reduced network and
CPU capabilities. As such, a home network device  exposing the
authoritative naming service for its home network on
the Internet may become vulnerable to resource
exhaustion attacks. One way to avoid exposing these devices is
to outsource the authoritative service to a third
party, e.g. ISP.
-->
                
The Homenet Naming Authority (HNA) is the designated device in charge of outsourcing the service to a third party, which requires setting up
                an architecture.

Such settings may be inappropriate for most
end users. This document defines DHCPv6 options so any
agnostic HNA can automatically proceed to the
appropriate configuration and outsource the
authoritative naming service for the home network. In
most cases, the outsourcing mechanism is transparent
for the end user. 

--- middle

# Requirements notation
            
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in {{!RFC2119}}.


# Terminology

The reader is expected to be familiar with {{?I-D.ietf-homenet-front-end-naming-delegation}} and its terminology section. This section defines terms that have not been defined in {{?I-D.ietf-homenet-front-end-naming-delegation}}:
            
* Client Public Key: designates a public key generated by the HNA. This
key is used as an authentication credential for the HNA.

* Homenet Zone Template: The template used as a basis to generate the
Homenet Zone.

* DNS Template Server: The DNS server that hosts the Homenet Zone Template.

* Homenet Reverse Zone: The reverse zone file associated to the Homenet Zone.

# Introduction
               
HNAs are usually constrained devices with reduced network and CPU
capacities. As such, a HNA hosting on the Internet the authoritative
naming service for its home network may become vulnerable to resource
exhaustion attacks. Outsourcing the authoritative service to a third
party avoids exposing the HNA to such attacks. This third party can be
the ISP or any other independent third party.

Outsourcing the authoritative naming service to a third party requires
setting up an architecture designated in this document as the
Outsourcing Infrastructure. These settings  may be inappropriate for
most end users that do not have the sufficient knowledge. To address
this issue, this document proposes DHCPv6 options so any agnostic HNA
can automatically set the Outsourcing Infrastructure. In most cases,
these DHCPv6 options are sufficient and do not require any additional
interaction from the end user, thus achieving a zero-config settings. In
some other cases, the end user is expected to perform some limited
manual configuration.  

When the HNA is plugged, the DHCPv6 options described in the document enable:
            
                
* 1). To build the Homenet Zone: Building the Homenet Zone requires
filling the zone with appropriated bindings such as bindings between the
names and the IP addresses of the different devices of the home
networks. How the HNA is aware of these binding is out of scope of the
document.  They may  be provided, for example, by the DHCPv6 server
hosted on the HNA. On the other hand, building the Homenet Zone also
requires configuration parameters like the name of the Registered Domain
Name associated to the home network or the Public Authoritative
Server(s) the Homenet Zone is outsourced to. These configuration
parameters are stored in the Homenet Zone Template. This document
describes the Zone Template Option which carries the FQDN associated to
the Homenet Zone Template. In order to retrieve the Homenet Zone
Template, the HNA sends a query of type AXFR {{!RFC1034}}, {{!RFC5936}}.

* 2). To upload the Homenet Zone to the Synchronization Server,  in charge
of publishing the Homenet Zone on the Public Authoritative Server(s).
This document describes the Synchronization Server Option that provides
the FQDN of the appropriated server. Note that, the document does not
consider whether the Homenet Zone is signed or not, and if signed, which
entity is responsible to sign it. Such questions are out of the scope of
the current document.

* 3). To upload the Homenet Reverse Zone to the Reverse Synchronization
Server in charge of publishing the Homenet Reverse Zone on the Reverse
Public Authoritative Server(s). This document describes the Reverse
Synchronization Server Option that provides the FQDN of the appropriated
server. Similarly to item 2., we do not consider in this document if the
Homenet Reverse Zone is signed or not, and if signed who signs it.   

* 4). To provide authentication credential (a public key) to the DHCP
Server: Information stored in the Homenet Zone Template, the Homenet
Zone and Homenet Reverse Zone belongs to the HNA, and only the HNA
should be able to update or upload these zones. To authenticate the HNA,
this document defines the Client Public Key Option. This option is sent
by the HNA to the DHCPv6 server and provides the Client Public Key the
HNA uses to authenticate itself. This document does not describe
mechanisms used to transmit the Client Public Key from the DHCPv6 server
to the appropriate entities. If the DHCPv6 server is not able to provide
the Client Public Key to the appropriated entities, then the end user is
likely to provide manually the Client Public Key to these entities. This
document illustrates two scenarios: one where the DHCPv6 server is
responsible for distributing the Client Public Key to the
Synchronization Servers and Reverse Synchronization Server. In the other
scenarios, the Client Public Key is distributed out of band. 
        

The DHCPv6 options described in this document make possible to configure
an Outsourcing Infrastructure with no or little configurations from the
end user. A zero-config setting is achieved if the the link between the
HNA and the DHCPv6 server and  the link between the DHCPv6 server and
the various DNS servers (Homenet Zone Server, the Reverse
Synchronization Server, Synchronization Server) are trusted. For
example, one way to provide a thrustworhy connection between the HNA and
the DHCPv6 server is defined in {{?I-D.ietf-dhc-sedhcpv6}}. When both
links are trusted, the HNA is able to provide its authentication
credentials (a Client Public Key) to the DHCPv6 server, that in turn
forwards it to the various DNS servers. With the authentication
credentials on the DNS servers, the HNA is able to securely update.

If the DHCPv6 server cannot provide the Client Public Key to one of
these servers (most likely the Synchronization Server) and the HNA needs
to interact with the server, then, the end user is expected to provide
the HNA's Client Public Key to these servers (the Reverse
Synchronization Server or the Synchronization Server) either manually or
using other mechanisms. Such mechanisms are outside the scope of this
document. In that case, the authentication credentials need to be
provided every time the key is modified. {{sec-scenario}} provides more
details on how different scenarios impact the end users.

The remaining of this document is structured as follows.
{{sec-overview}} provides an overview of the DHCPv6 options as well as
the expected interactions between the HNA and the various involved
entities. This section also provides an overview of available mechanisms
to secure DNS transactions and update DNS data.
{{sec-cpe-configuration}} describes how the HNA may securely synchronize
and update DNS data. {{sec-format}} describes the payload of the DHCPv6
options and {{sec-dhcp-behavior}} details how DHCPv6 client, server and
relay agent behave. {{sec-iana}} lists the new parameters to be
registered at the IANA, {{security-considerations}} provides security
considerations. Finally, {{sec-scenario}} describes how the HNA may
behave and be configured regarding various scenarios.

# Protocol Overview {#sec-overview}

This section provides an overview of the HNA's interactions with the
Outsourcing Infrastructure in {{sec-arch}}, and so the necessary for its
setting. In this document, the configuration is provided via DHCPv6
options. Once configured, the HNA is expected to be able to update and
publish DNS data on the different components of the Outsourcing
Infrastructure. As a result authenticating and updating mechanisms play
an important role in the specification. {{sec-sec-exchange}} provides an
overview of the different authentication methods and {{sec-update}}
provides an overview of the different update mechanisms considered to
update the DNS data.

## Architecture and DHCPv6 Options Overview {#sec-arch}

This section illustrates how a HNA receives the necessary information
via DHCPv6 options to outsource its authoritative naming service on the
Outsourcing Infrastructure. For the sake of simplicity, this section
assumes that the DHCPv6 server is able to communicate to the various DNS
servers and to provide them the public key associated with the HNA. Once
each server got the public key, the HNA can proceed to transactions in
an authenticated and secure way.

This scenario has been chosen as it is believed to be the most popular
scenario. This document does not ignore that scenarios where the DHCP
Server does not have privileged relations with the Synchronization
Server must be considered. These cases are discussed latter in
{{sec-scenario}}. Such scenario does not necessarily require
configuration for the end user and can also be zero-config.

The scenario is represented in {{fig-protocol-overview}}.

* 1) The HNA provides its Client Public Key to the DHCP Server using a
Client Public Key Option (OPTION_PUBLIC_KEY) and includes the following
option codes in its its Option Request Option (ORO): Zone Template
Option (OPTION_DNS_ZONE_TEMPLATE), the Synchronization Server Option
(OPTION_SYNC_SERVER) and the Reverse Synchronization Server Option
(OPTION_REVERSE_SYNC_SERVER).

* 2) The DHCP Server makes the Client Public Key available to the DNS
servers, so the HNA can secure its DNS transactions. How the Client
Public Key is transmitted to the various DNS servers is out of scope of
this document. Note that the Client Public Key alone is not sufficient
to perform the authentication and the key should be, for example,
associated with an identifier, or the concerned domain name. How the
binding is performed is out of scope of the document. It can be a
centralized database or various bindings may be sent to the different
servers. {{fig-protocol-overview}} represents the specific case where
the DHCP Server forwards the set (Client Public Key, Zone Template FQDN)
to the DNS Template Server, the set (Client Public Key, IPv6 subnet) to
the Reverse Synchronization Server and the set (Client Public Key,
Registered Homenet Domain) to the Synchronization Server.

* 3) The DHCP Server responds to the HNA with the requested DHCPv6
options, i.e. the Client Public Key Option (OPTION_PUBLIC_KEY), Zone
Template Option OPTION_DNS_ZONE_TEMPLATE, Synchronization Server Option
(OPTION_SYNC_SERVER), Reverse Synchronization Server Option
(OPTION_REVERSE_SYNC_SERVER). Note that this step may be performed in
parallel to step 2, or even before. In other words, there is no
requirements that step 3 is conducted after step 2.

* 4) Upon receiving the Zone Template Option (OPTION_DNS_ZONE_TEMPLATE),
the HNA performs an AXFR DNS query for the Zone Template FQDN. The
exchange is authenticated  according to the authentication methods
defined in the Supported Authentication Methods field of the DHCP
option. Once the HNA has retrieved the DNS Zone Template, the HNA can
build the Homenet Zone and the Homenet Reverse Zone. Eventually the HNA
signs these zones.

* 5) Once the Homenet Reverse Zone has been set, the HNA uploads the zone
to the Reverse Synchronization Server. The Reverse Synchronization
Server Option (OPTION_REVERSE_SYNC_SERVER) provides the Reverse
Synchronization Server FQDN as well as the upload method, and the
Supported Authentication Methods protocol to secure the upload.

6) Once the Homenet Zone has been set, the HNA uploads the zone to the
Synchronization Server. The Synchronization Server Option
(OPTION_SYNC_SERVER) provides the Synchronization Server FQDN as well as
the upload method and the authentication method to secure the upload.
        
~~~
     +---------------------+
     |    DHCPv6 Server    |
     +---------------------+
          ^  ^         ^
          |  |         |
        1.|  |3.       |2.
          |  |         |
          v  v         |
        +------+       |    +--------------------------------+
        |      |  4.   +--->|  DNS Template Server           |
        |      |<---------->|                                |
        |      |       |    +--------------------------------+
        | HNA  |       |
        |      |       |    +--------------------------------+
        |      | 5./6. +--->|  Reverse Synchronization       |
        |      |<---------->|  Server                        |
        |      |       |    +--------------------------------+
        |      |       |
        |      |       |    +--------------------------------+
        +------+       +--->|  Synchronization Server        |
                            |                                |
                            +--------------------------------+
~~~
{: #fig-protocol-overview title="Protocol Overview"}

As described above, the HNA is likely to interact with various DNS content. More specifically, the HNA is likely to update the:
                
* Homenet Zone Template: if the configuration of the zone may be changed.
This may include additional Public Authoritative Server(s), a different
Registered Homenet Domain as the one initially proposed, or a
redirection to another domain.

* Homenet Reverse Zone: every time a new device is connected or
dis-connected.

* Homenet Zone: every time a new device is connected, dis-connected.
        
Step 2 and step 3 should be considered as independent steps and could be
re-ordered. In fact, the DHCPv6 server does not have to wait for a
confirmation from the DNS servers the Client Public Key has been
properly received, and is operational by the DNS servers. The DHCP
Server is expected to reply upon receiving the Client Public Key Option.
The reply to the message with a Client Public Key Option from the DHCP
Server is interpreted by the DHCPv6 client as a confirmation of the
reception of the option by the DHCP Server only. It does not indicate
whether the server had processed the option or not. Debugging
configurations errors or transmission error with one of the DNS servers
is let to the HNA and thus is outside of the scope of the DHCPv6. 

First, it is unlikely a DNS server can validate that the Client Public
Key will be operational for the HNA, as multiple causes of errors could
occur. For example, the Client Public Key may have been changed during
the transmission or by the DHCP Server, or the DNS server may be
misconfigured.  Second, the number of error codes would be too complex.
In addition to multiple causes of errors, multiple architectures and
multiple DNS servers may be involved. 

Third, this may cause significant DHCP Server performance degradation.

In fact, the HNA performs these updates in a secure manner. There are
multiple ways to secure a DNS transaction and this document considers
two mechanisms: nsupdate and primary/secondary synchronization.
{{sec-sec-exchange}}  describes the authentication method that may be
use to secure the DNS transactions of the HNA. The appropriate
authentication methods may, for example, be chosen according to the
level of confidentiality or the level of authentication requested by the
HNA transactions.  {{sec-update}} positions the nsupdate and
primary/secondary synchronization mechanisms. The update appropriate
update mechanism  may depend on the for example on the update frequency
or the size of the DNS data to update.

## Mechanisms Securing DNS Transactions   {#sec-sec-exchange}

Multiple protocols like IPsec {{!RFC4301}} or TLS / DTLS {{!RFC5246}} / {{!RFC6347}} may be used to secure DNS transactions between the HNA and the DNS servers. This document limits its scope to authentication method that have been designed specifically for DNS. This includes DNSSEC {{!RFC4033}}, {{!RFC4034}}, {{!RFC4035}} that authenticates and provides integrity protection of DNS data, TSIG {{!RFC2845}}, {{!RFC2930}} that use a shared secret to secure a transaction between two end points and SIG(0) {{!RFC2931}} authenticates the DNS packet exchanged.

The key issue with TSIG is that a shared secret must be negotiated
between the HNA and the server. On the other hand, TSIG performs
symmetric cryptography which is light in comparison with asymmetric
cryptography used by SIG(0). As a result, over large zone transfer, TSIG
may be preferred to SIG(0).

This document does not provide means to distribute shared secret for
example using a specific DHCPv6 option. The only assumption made is that
the HNA generates or is assigned a public key.

As a result, when the document specifies the transaction is secured with
TSIG, it means that either the HNA and the DNS server have been manually
configured with a shared secret, or the shared secret has been
negotiated using TKEY {{!RFC2930}}, and the TKEY exchanged are secured
with SIG(0).

Exchanges with the DNS Template Server to retrieve the Homenet Zone
Template may be protected by SIG(0), TSIG or DNSSEC. When DNSSEC is
used, it means the DNS Template Server only provides integrity
protection, and does not necessarily prevent someone else to query the
Homenet Zone Template. In addition, DNSSEC is only a way to protect the
AXFR queries transaction, in other words, DNSSEC cannot be used to
secure updates. If DNSSEC is used to provide integrity protection for
the AXFR response, the HNA should proceed to the DNSSEC signature
checks. If signature check fails, it MUST reject the response. If the
signature check succeeds, the HNA removes all DNSSEC related RRsets
(DNSKEY, RRSIG, NSEC* ...) before building the Homenet Zone. In fact,
these DNSSEC related fields are associated to the Homenet Zone Template
and not the Homenet Zone.

Any update exchange should use SIG(0) or TSIG to authenticate the
exchange.
   

## Primary / Secondary Synchronization versus DNS Update {#sec-update}

As updates only concern DNS zones, this document only considers DNS
update mechanisms such as DNS update  {{!RFC2136}}  {{!RFC3007}} or a
primary / secondary synchronization.

The Homenet Zone Template SHOULD be updated with DNS update as it
contains static configuration data that is not expected to evolve over
time.

The Homenet Reverse Zone and the Homenet Zone can be updated either with
DNS update or using a primary / secondary synchronization. As these
zones may be large, with frequent updates, we recommend to use the
primary / secondary architecture as described in
{{?I-D.ietf-homenet-front-end-naming-delegation}}. The primary /
secondary mechanism is preferred as it better scales and avoids DoS
attacks: First the primary notifies the secondary the zone must be
updated, and leaves the secondary to proceed to the update when
possible. Then, the NOTIFY message sent by the primary is a small packet
that is less likely to load the secondary. At last, the AXFR query
performed by the secondary is a small packet sent over TCP (section 4.2
{{!RFC5936}}) which makes unlikely the secondary to perform reflection
attacks with a forged NOTIFY. On the other hand, DNS updates can use
UDP, packets require more processing than a NOTIFY, and they do not
provide the server the opportunity to postpone the update.



# HNA Configuration {#sec-cpe-configuration}

## HNA Primary / Secondary Synchronization Configurations {#sec-cpe-ms-settings}

The primary / secondary architecture is described in
{{?I-D.ietf-homenet-front-end-naming-delegation}}. The HNA hosts a
Hidden Primary that synchronizes with a  Synchronization Server or the
Reverse Synchronization Server.

When the HNA is plugged its IP address may be unknown to the secondary.
The section details how the HNA or primary communicates the necessary
information to set up the secondary.

In order to set the primary / secondary configuration, both primary and
secondaries must agree on 1) the zone to be synchronized, 2) the IP
address and ports used by both primary and secondary.


## HNA / Synchronization Server  {#sec-cpe-nsset}

 The HNA is aware of  the zone to be synchronized by reading the
Registered Homenet Domain in the Homenet Zone Template provided by the
Zone Template Option (OPTION_DNS_ZONE_TEMPLATE). The IP address of the
secondary is provided by the Synchronization Server Option
(OPTION_SYNC_SERVER).

The Synchronization Server has been configured with the Registered
Homenet Domain and the Client Public Key that identifies the HNA. The
only missing information is the IP address of the HNA. This IP address
is provided by the HNA by sending a NOTIFY {{!RFC1996}}.

When the HNA has built its Homenet Zone, it sends a NOTIFY message to
the Synchronization Servers. Upon receiving the NOTIFY message, the
secondary reads the Registered Homenet Domain and checks the NOTIFY is
sent by the authorized primary. This can be done using the shared secret
(TSIG) or the public key (SIG(0)). Once the NOTIFY has been
authenticated, the Synchronization Servers might consider the source IP
address of the NOTIFY query to configure the primaries attributes.

### HNA / Reverse Synchronization Server
   
The HNA is aware of  the zone to be synchronized by looking at its
assigned prefix. The IP address of the secondary is provided by the
Reverse Synchronization Server Option (OPTION_REVERSE_SYNC_SERVER).

Configuration of the secondary is performed as illustrated in
{{sec-cpe-nsset}}.
 
## HNA DNS Data Handling {#sec-cpe-updates}

### Homenet Zone Template
 
The Homenet Zone Template contains at least the related
fields of the Public Authoritative Server(s) as well as the Homenet
Registered Domain, that is SOA, and NS fields. This template might be
generated automatically by the owner of the DHCP Server. For example, an
ISP might provide a default Homenet Registered Domain as well as default
Public Authoritative Server(s). This default settings should provide the
HNA the necessary pieces of information to set the homenet naming
architecture.

If the Homenet Zone Template is not subject to modifications or updates,
the owner of the template might only use DNSSEC to enable integrity
check. 
                  
On the other hand, the Homenet Zone Template might also be subject to
modification by the HNA. The advantage of using the standard DNS zone
format is that standard DNS update mechanism can be used to perform
updates. These updates might be accepted or rejected by the owner of the
Homenet Zone Template. Policies that defines what is accepted or
rejected is out of scope of this document. However, this document
assumes the Registered Homenet Domain is used as an index by the
Synchronization Server, and SIG(0), TSIG are used to authenticate the
HNA. As a result, the Registered Homenet Domain should not be modified
unless the Synchronization Server can handle with it.

### DNS (Reverse) Homenet Zone

The Homenet Zone might be generated from the Homenet Zone Template. How
the Homenet Zone is generated is out of scope of this document. In some
cases, the Homenet Zone might be the exact copy of the Homenet Zone
Template. In other cases, it might be generated from the Homenet Zone
Template with additional RRsets. In some other cases, the Homenet Zone
might be generated without considering the Homenet Zone Template, but
only considering specific configuration rules.

In the current document the HNA only sets a single zone that is
associated with one single Homenet Registered Domain. The domain might
be assigned by the owner of the Homenet Zone Template. This constraint
does not prevent the HNA to use multiple domain names. How additional
domains are considered is out of scope of this document. One way to
handle these additional zones is to configure static redirections to the
Homenet Zone using CNAME {{!RFC2181}}, {{!RFC1034}}, DNAME {{!RFC6672}}
or CNAME+DNAME {{?I-D.sury-dnsext-cname-dname}}.

# Payload Description {#sec-format}
            
This section details the payload of the DHCPv6 options. A few DHCPv6
options are used to advertise a server the HNA may be expected to
interact with. Interaction may require to define update and
authentication methods. Update fields are shared by multiple DHCPv6
options and are described in separate sections. {{sec-sec-field}}
describes the Supported Authentication Method field,
{{sec-update-field}} describes the Update field, the remaining
{{sec-key}},  {{sec-zone-template}},  {{sec-auth-ns-set}},
{{sec-auth-rns}} describe the DHCPv6 options.  

## Supported Authentication Methods Field {#sec-sec-field}            

The Supported Authentication Methods field of the DHCPv6 option represented in {{fig-sec-field}} indicates the authentication method supported by the DNS server. One of these mechanism MUST be chosen by the HNA in order to perform a transaction with the DNS server. See {{sec-sec-exchange}} for more details.
                    
~~~ 
 0                   1                  
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Supported Auth. Methods    |                                   
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                                   
~~~
{: #fig-sec-field title="Supported Authentication Methods Filed"}
               
                        <t hangText="- 

* DNS (Bit 0): indicates, when set to 1, that DNS without any security
extension is supported.

* DNSSEC (Bit 1): indicates, when set to 1, that DNSSEC provides integrity
protection. This can only be used for read operations like retrieving
the Homenet Zone Template.

* SIG(0) (Bit 2): indicates, when set to 1, that transaction protected by
SIG(0) are supported.

* TSIG (Bit 3): indicates, when set to 1, that transaction using TSIG is
supported. Note that if a shared secret has not been previously
negotiated between the two party, it should be negotiated using TKEY.
The TKEY exchanges MUST be protected with SIG(0) even though SIG(0) is
not supported.

Remaining Bits (Bit 4-15): MUST be set to 0 by the DHCP Server and MUST
be ignored by the DHCPv6 client.
            
A Supported Authentication Methods field with all bits set to zero
indicates the operation is not permitted. The Supported Authentication
Methods field may be set to zero when updates operations are not
permitted for the DNS Homenet Template. In any other case this is an
error.
 
### Update Field {#sec-update-field}
            
The Update Field of the DHCPv6 option is represented in
{{fig-update-field}}. It indicates the update mechanism supported by the
DNS server. See {{sec-update}} for more details.

                    
~~~ 
 0                                 
 0 1 2 3 4 5 6 7
+-+-+-+-+-+-+-+-+
|    Update     |                                           
+-+-+-+-+-+-+-+-+                                 
~~~
{: #fig-update-field title="Update Field" }

* Primary / Secondary (Bit 0): indicates, when set to 1, that DNS Server
supports data synchronization using a Primary / Secondary mechanism.

* DNS Update (Bit 1): indicates, when set to 1, that DNS Server supports
data synchronization using DNS Updates.

* Remaining Bits (Bit 2-7): MUST be set to 0 by the DHCPv6 server and
MUST be ignored by the DHCPv6 client.
            
## Client Public Key Option {#sec-key}
            
The Client Public Key Option (OPTION_PUBLIC_KEY) indicates the Client
Public Key that is used to authenticate the HNA. This option is defined
in {{?I-D.ietf-dhc-sedhcpv6}}.

<!--
                    <figure title="Client Public Key Option" anchor="fig-public-key">
                        <artwork>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     OPTION_PUBLIC_KEY         |         option-len            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                        Public Key Data                        /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                 </artwork>
                     </figure>
               
                    <list style="hanging" hangIndent="6">
                        <t hangText="- OPTION_PUBLIC_KEY:"> the option code for the Client Public Key Option (TBD1).
                        <t hangText="- option-len (16 bits):"> length in octets of the option-data field as described in {{!RFC3315}}.
                        <t hangText="- Client Public Key Data:"> contains the Client Public Key. The format is the DNSKEY RDATA format as defined in {{!RFC4034}}.  
                    </list>
            
-->

## Zone Template Option {#sec-zone-template}

The Zone Template Option (OPTION_DNS_ZONE_TEMPLATE) Option indicates the
HNA how to retrieve the Homenet Zone Template. It provides a FQDN the
HNA SHOULD query with a DNS query of type AXFR as well as the
authentication methods associated to the AXFR query or the nsupdate
queries. Homenet Zone Template update, if permitted MUST use the DNS
Update mechanism.

~~~
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    OPTION_DNS_ZONE_TEMPLATE   |          option-len           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Supp. Auth. Methods (axfr)    | Supp. Auth. Methods (update)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                        Zone Template FQDN                     /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~~~
{: #fig-zone-template title="Zone Template Option"}


* option-code: (16 bits): OPTION_DNS_ZONE_TEMPLATE, the option code for
the Zone Template Option (TBD1).

* option-len (16 bits): length in octets of the option-data field as
described in {{!RFC3315}}.

* Supported Authentication Methods(axfr) (16 bits): defines which
authentication methods are supported by the DNS server. This field
concerns the AXFR and consultation queries, not the update queries. See
{{sec-sec-field}} for more details.

* Supported Authentication Methods (16 bits): defines which authentication
methods are supported by the DNS server. This field concerns the update.
See {{sec-sec-field}} for more details.

* Zone Template FQDN FQDN (variable): the FQDN of the DNS server hosting
the Homenet Zone Template.

## Synchronization Server Option {#sec-auth-ns-set}

The Synchronization Server Option (OPTION_SYNC_SERVER) provides information necessary for the HNA to upload the Homenet Zone to the Synchronization Server. Finally, the option provides the authentication methods that are available to perform the upload. The upload is performed via a DNS primary / secondary architecture or DNS updates.

~~~
 0                   1                        2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        OPTION_SYNC_SERVER     |          option-len           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Supported Auth. Methods       |    Update     |     Server    /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
/     Port      |                                               |
+-+-+-+-+-+-+-+-+                                               |
|                                                               |
/                    Synchronization Server FQDN                /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~~~
{ #fig-name-srv-set title="Synchronization Server Option"}


* option-code (16 bits): OPTION_SYNC_SERVER, the option code for the
Synchronization Server Option (TBD2).

* option-len (16 bits): length in octets of the option-data field as
described in {{!RFC3315}}.

* Supported Authentication Methods (16 bits): defines which
authentication methods are supported by the DNS server. See
{{sec-sec-field}} for more details.

* Update (8 bits): defines which update mechanisms are supported by the
DNS server. See {{sec-update}} for more details.

* Server Port (16 bits): defines the port the Synchronization Server is
listening. When multiple transport layers may be used, a single and
unique Server Port value applies to all the transport layers. In the
case of DNS for example, Server Port value considers DNS exchanges
using UDP and TCP.
                         
* Synchronization Server FQDN (variable): the FQDN of the
Synchronization Server.

## Reverse Synchronization Server Option {#sec-auth-rns}

The Reverse Synchronization Server Option (OPTION_REVERSE_SYNC_SERVER)
provides information necessary for the HNA to upload the Homenet Zone to
the Synchronization Server. The option provides the authentication
methods that are available to perform the upload. The upload is
performed via a DNS primary / secondary architecture or DNS updates.
                    
~~~
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  OPTION_REVERSE_SYNC_SERVER   |         option-len            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Supported Auth. Methods       |     Update    |   Server      /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
/         Port    |                                             |
+-+-+-+-+-+-+-+-+-+                                             |
|                                                               |
/                Reverse Synchronization Server FQDN            /
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~~~
{: #fig-rever-srv-name-set title="Reverse Synchronization Server Option"}
               

* option-code (16 bits): OPTION_REVERSE_SYNC_SERVER, the option code for
the Reverse Synchronization Server Option (TBD3).

* option-len (16 bits): length in octets of the option-data field as
described in {{!RFC3315}}.

* Supported Authentication Methods (16 bits)" defines which authentication
methods are supported by the DNS server. See {{sec-sec-field}} for more
details.

* Update (8 bits): defines which update mechanisms are supported by the
DNS server. See {{sec-update}} for more details.

* Server Port (16 bits): defines the port the Synchronization Server is
listening.

* Reverse Synchronization Server FQDN (variable): The FQDN of the Reverse
Synchronization Server.
                
# DHCP Behavior {#sec-dhcp-behavior}
            
## DHCPv6 Server Behavior
           
Sections 17.2.2 and 18.2 of {{!RFC3315}} govern server operation in
regards to option assignment.  As a convenience to the reader, we
mention here that the server will send option foo only if configured
with specific values for foo and if the client requested it. In
particular, when configured the DHCP Server sends the Zone Template
Option, Synchronization Server Option, Reverse Synchronization Server
Option when requested by the DHCPv6 client by including necessary option
codes in its ORO.

The DHCP Server may receive a Client Public Key Option
(OPTION_PUBLIC_KEY) from the HNA. Upon receipt of this DHCPv6 option,
the DHCP Server SHOULD acknowledge the reception of the Client Public
Key Option as described in {{sec-arch}} and communicate this credential
to the available DNS Servers like the DNS Template Server, the
Synchronization Server and the Reverse Synchronization Server, unless
not configured to do so.

A HNA may update its Client Public Key by sending a new value in the
Client Public Key Option (OPTION_PUBLIC_KEY) as this document assumes
the link between the HNA and the DHCP Server is considered authenticated
and trusted. The server SHOULD process received Client Public Key Option
sent by the client (see step 2 in {{sec-arch}}), unless not configured
to do so.  

## DHCPv6 Client Behavior

            
The DHCPv6 client SHOULD send a Client Public Key Option
(OPTION_PUBLIC_KEY) to the DHCP Server. This Client Public Key
authenticates the HNA.
            
The DHCPv6 client sends a ORO with the necessary option codes: Zone
Template Option, Synchronization Server Option and Reverse
Synchronization Server Option.
	    
<!-- tomek: removed this text. Client should always reuqest those
options. That's a standard DHCP mechanism for the client to learn any
changes to the network configuration.  A HNA SHOULD only send the an ORO
request for DHCPv6 options it needs or for information that needs to be
up-to-date. -->
            
Upon receiving a DHCP option described in this document in the Reply
message, the HNA SHOULD retrieve or update DNS zones using the
associated Supported Authentication Methods and update protocols, as
described in {{sec-cpe-configuration}}.
 

## DHCPv6 Relay Agent Behavior {#sec-dhcp-relay}

There are no additional requirements for the DHCP Relay agents.

# IANA Considerations {#sec-iana}

The DHCP options detailed in this document is:
* OPTION_DNS_ZONE_TEMPLATE: TBD1
* OPTION_SYNC_SERVER: TBD2
* OPTION_REVERSE_SYNC_SERVER: TBD3


# Security Considerations" {#security-considerations}

## DNSSEC is recommended to authenticate DNS hosted data

It is recommended that the (Reverse) Homenet Zone is signed with DNSSEC. The zone may be signed by the HNA or by a third party. We recommend the zone to be signed by the HNA, and that the signed zone is uploaded.  


## Channel between the HNA and ISP DHCP Server MUST be secured

The channel MUST be secured because the HNA provides authentication
credentials. Unsecured channel may result in HNA impersonation attacks.

The document considers that the channel between the HNA and the ISP DHCP
Server is trusted. More specifically, the HNA is authenticated and the
exchanged messages are protected. The current document does not specify
how to secure the channel.  {{!RFC3315}} proposes a DHCP authentication
and message exchange protection, {{!RFC4301}}, {{!RFC7296}} propose to
secure the channel at the IP layer.

## HNAs are sensitive to DoS

HNA have not been designed for handling heavy load.  The HNA are exposed
on the Internet, and their IP address is publicly published on the
Internet via the DNS. This makes the Home Network sensitive to Deny of
Service Attacks. The resulting outsourcing architecture is described in
{{?I-D.ietf-homenet-front-end-naming-delegation}}. This document shows
how the outsourcing architecture can be automatically set.

# Acknowledgments

We would like to thank Marcin Siodelski and Bernie Volz for their
comments on the design of the DHCPv6 options. We would also like to
thank Mark Andrews, Andrew Sullivan and Lorenzo Colliti for their
remarks on the architecture design. The designed solution has been
largely been inspired by Mark Andrews's document
{{?I-D.andrews-dnsop-pd-reverse}} as well as discussions with Mark. We
also thank Ray Hunter for its reviews, its comments and for suggesting
an appropriated terminology.
            
# Scenarios and impact on the End User {#sec-scenario}

This section details various scenarios and discuss their impact
on the end user.

# Base Scenario {#sec-scenario-1}

The base scenario is the one described in  {{sec-overview}}. It is
typically the one of an ISP that manages the DHCP Server, and all DNS
servers.

The end user subscribes to the ISP (foo), and at subscription time
registers for example.foo as its Registered Homenet Domain example.foo.
Since the ISP knows the Registered Homenet Domain and the Public
Authoritative Server(s) the ISP is able to build the Homenet Zone
Template.

The ISP manages the DNS Template Server, so it is able to load the
Homenet Zone Template on the DNS Template Server.

When the HNA is plugged (at least the first time), it provides its
Client Public Key to the DHCP Server. In this scenario, the DHCP Server
and the DNS Servers are managed by the ISP so the DHCP Server can
provide authentication credentials of the HNA to enable secure
authenticated transaction between the HNA and these DNS servers. More
specifically, credentials are provided to:

* Synchronization Server
* Reverse Synchronization Server
* DNS Template Server
    

The HNA can update the zone using DNS update or a primary / secondary
configuration in a secure way.                 

The main advantage of this scenario is that the naming architecture is
configured automatically and transparently for the end user.  The
drawbacks are that the end user uses a Registered Homenet Domain managed
by the ISP and that it relies on the ISP naming infrastructure.

## Third Party Registered Homenet Domain {#scenario-2}

This section considers the case when the end user wants its home network
to use example.com as a Registered Homenet Domain instead of example.foo
that has been assigned by the ISP. We also suppose that example.com is
not managed by the ISP.

This can also be achieved without any configuration. When the end user
buys the domain name example.com, it may request to redirect the name
example.com to example.foo using static redirection with CNAME
{{!RFC2181}}, {{!RFC1034}}, DNAME {{!RFC6672}} or CNAME+DNAME
{{?I-D.sury-dnsext-cname-dname}}.

This configuration is performed once when the domain name example.com is
registered. The only information the end user needs to know is the
domain name assigned by the ISP. Once this configuration is done no
additional configuration is needed anymore. More specifically, the HNA
may be changed, the zone can be updated as in {{sec-scenario-1}} without
any additional configuration from the end user.

The main advantage of this scenario is that the end user benefits from
the Zero Configuration of the Base Scenario {{sec-scenario-1}}. Then,
the end user is able to register for its home network an unlimited
number of domain names provided by an unlimited number of different
third party providers.  he drawback of this scenario may be that the end
user still rely on the ISP naming infrastructure. Note that the only
case this may be inconvenient is when the DNS Servers provided by the
ISPs results in high latency.


## Third Party DNS Infrastructure {#scenario-3}

This scenario considers that the end user uses example.com as a
Registered Homenet Domain, and does not want to rely on the
authoritative servers provided by the ISP.

In this section we limit the outsourcing to the Synchronization Server
and Public Authoritative Server(s) to a third party. All other DNS
Servers DNS Template Server, Reverse Public Authoritative Server(s) and
Reverse Synchronization Server remain managed by the ISP. The reason we
consider that Reverse Public Authoritative Server(s) and Reverse
Synchronization Server remains managed by the ISP are that the prefix is
managed by the ISP, so outsourcing these resources requires some
redirection agreement with the ISP. More specifically the ISP will need
to configure the redirection on one of its Reverse DNS Servers. That
said, outsourcing these resources is similar as outsourcing
Synchronization Server and Public Authoritative Server(s) to a third
party. Similarly, the DNS Template Server can be easily outsourced as
detailed in this section

Outsourcing Synchronization Server and Public Authoritative Server(s) requires:

* 1) Updating the Homenet Zone Template: this can be easily done as
detailed in {{sec-update}} as the DNS Template Server is still managed
by the ISP. Such modification can be performed once by any HNA. Once
this modification has been performed, the HNA can be changed, the Client
Public Key of the HNA may be changed, this does not need to be done
another time. One can imagine a GUI on the HNA asking the end user to
fill the field with Registered Homenet Domain, optionally Public
Authoritative Server(s), with a button "Configure Homenet Zone
Template".

* 2) Updating the DHCP Server Information. In fact the Reverse
Synchronization Server returned by the ISP is modified. One can imagine
a GUI interface that enables the end user to modify its profile
parameters. Again, this configuration update is done once-for-ever.

* 3) Upload the authentication credential of the HNA, that is the Client
Public Key of the HNA, to the third party. Unless we use specific
mechanisms, like communication between the DHCP Server and the third
party, or a specific token that is plugged into the HNA, this operation
is likely to be performed every time the HNA is changed, and every time
the Client Public Key generated by the HNA is changed.
             
The main advantage of this scenario is that the DNS infrastructure is
completely outsourced to the third party. Most likely the Client Public
Key that authenticate the HNA need to be configured for every HNA.
Configuration is expected to be HNA live-long. 

## Multiple ISPs {#scenario-4}

This scenario considers a HNA connected to multiple ISPs.

Firstly, suppose the HNA has been configured with the based scenarios
exposed in {{sec-scenario-1}}. The HNA has multiple interfaces, one for
each ISP, and each of these interface is configured using DHCP. The HNA
sends to each ISP its Client Public Key Option as well as a request for
a Zone Template Option, a Synchronization Server Option and a Reverse
Synchronization Server Option. Each ISP provides the requested DHCP
options, with different values. Note that this scenario assumes, the
home network has a different Registered Homenet Domain for each ISP as
it is managed by the ISP. On the other hand, the HNA Client Public Key
may be shared between the HNA and the multiple ISPs. The HNA builds the
associate DNS(SEC) Homenet Zone, and proceeds to the various settings as
described in  {{sec-scenario-1}}.

The protocol and DHCPv6 options described in this document are fully
compatible with a HNA connected to multiple ISPs with multiple
Registered Homenet Domains. However, the HNA should be able to handle
different Registered Homenet Domains. This is an implementation issue
which is outside the scope of the current document. More specifically,
multiple Registered Homenet Domains leads to multiple DNS(SEC) Homenet
Zones. A basic implementation may erase the DNS(SEC) Homenet Zone that
exists when it receives DHCPv6 options, and rebuild everything from
scratch. This will work for an initial configuration but comes with a
few drawbacks. First, updates to the DNS(SEC) Homenet Zone may only push
to one of the multiple Registered Homenet Domain, the latest Registered
Homenet Domain that has been set, and this is most likely expected to be
almost randomly chosen as it may depend on the latency on each ISP
network at the boot time. As a  results, this leads to unsynchronized
Registered Homenet Domains. Secondly, if the HNA handles in some ways
resolution, only the latest Registered Homenet Domain set may be able to
provide naming resolution in case of network disruption.

Secondly, suppose the HNA is connected to multiple ISP with a single
Registered Homenet Domain. In this case, the one party is chosen to host
the Registered Homenet Domain. This entity may be one of the ISP or a
third party. Note that having multiple ISPs can be motivated for
bandwidth aggregation, or connectivity fail-over. In the case of
connectivity fail-over, the fail-over concerns the access network and a
failure of the access network may not impact the core network where the
Synchronization Server and Public Authoritative Primaries are hosted. In
that sense, choosing one of the ISP even in a scenario of multiple ISPs
may make sense. However, for sake of simplicity, this scenario assumes
that a third party has be chosen to host the Registered Homenet Domain.
The DNS settings for each ISP is described in {{scenario-2}} and
{{scenario-3}}. With the configuration described in {{scenario-2}},  the
HNA is expect to be able to handle multiple Homenet Registered Domain,
as the third party redirect to one of the ISPs Servers. With the
configuration described in {{scenario-3}}, DNS zone are hosted and
maintained by the third party. A single DNS(SEC) Homenet Zone is built
and maintained by the HNA. This latter configuration is likely to match
most HNA implementations.


The protocol and DHCPv6 options described in this document are fully
compatible with a HNA connected to multiple ISPs. To configure or not
and how to configure the HNA depends on the HNA facilities.
{{sec-scenario-1}} and  {{scenario-2}} require the HNA to handle
multiple Registered Homenet Domain, whereas {{scenario-3}} does not have
such requirement.  


